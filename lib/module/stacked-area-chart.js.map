{"version":3,"sources":["stacked-area-chart.js"],"names":["PropTypes","array","scale","shape","React","PureComponent","View","Svg","Path","AreaStack","height","width","extractDataPoints","data","keys","order","stackOrderNone","offset","stackOffsetNone","series","stack","merge","_onLayout","event","nativeEvent","layout","setState","render","colors","animate","animationDuration","style","curve","numberOfTicks","contentInset","top","bottom","left","right","gridMin","gridMax","children","svgs","xAccessor","xScale","clampY","clampX","props","state","length","yValues","xValues","map","item","index","yExtent","extent","xExtent","yMin","yMax","xMin","xMax","y","scaleLinear","domain","range","clamp","x","ticks","areas","serie","path","area","d","y0","y1","_","key","color","extraProps","flex","Children","child","belowChart","cloneElement","propTypes","arrayOf","object","isRequired","string","func","any","bool","number","showGrid","defaultProps","curveLinear","strokeWidth"],"mappings":";;;;AAAA,OAAOA,SAAP,MAAsB,YAAtB;AACA,OAAO,KAAKC,KAAZ,MAAuB,UAAvB;AACA,OAAO,KAAKC,KAAZ,MAAuB,UAAvB;AACA,OAAO,KAAKC,KAAZ,MAAuB,UAAvB;AACA,OAAOC,KAAP,IAAgBC,aAAhB,QAAqC,OAArC;AACA,SAASC,IAAT,QAAqB,cAArB;AACA,SAASC,GAAT,QAAoB,kBAApB;AACA,OAAOC,IAAP,MAAiB,iBAAjB;;AAEA,MAAMC,SAAN,SAAwBJ,aAAxB,CAAsC;AAAA;AAAA;;AAAA,mCAY1B;AACJK,MAAAA,MAAM,EAAE,CADJ;AAEJC,MAAAA,KAAK,EAAE;AAFH,KAZ0B;AAAA;;AAClC,SAAOC,iBAAP,CAAyBC,IAAzB,EAA+BC,IAA/B,EAAqCC,KAAK,GAAGZ,KAAK,CAACa,cAAnD,EAAmEC,MAAM,GAAGd,KAAK,CAACe,eAAlF,EAAmG;AAC/F,UAAMC,MAAM,GAAGhB,KAAK,CACfiB,KADU,GAEVN,IAFU,CAELA,IAFK,EAGVC,KAHU,CAGJA,KAHI,EAIVE,MAJU,CAIHA,MAJG,EAIKJ,IAJL,CAAf,CAD+F,CAO/F;;AACA,WAAOZ,KAAK,CAACoB,KAAN,CAAYpB,KAAK,CAACoB,KAAN,CAAYF,MAAZ,CAAZ,CAAP;AACH;;AAODG,EAAAA,SAAS,CAACC,KAAD,EAAQ;AACb,UAAM;AACFC,MAAAA,WAAW,EAAE;AACTC,QAAAA,MAAM,EAAE;AAAEf,UAAAA,MAAF;AAAUC,UAAAA;AAAV;AADC;AADX,QAIFY,KAJJ;AAKA,SAAKG,QAAL,CAAc;AAAEhB,MAAAA,MAAF;AAAUC,MAAAA;AAAV,KAAd;AACH;;AAEDgB,EAAAA,MAAM,GAAG;AACL,UAAM;AACFd,MAAAA,IADE;AAEFC,MAAAA,IAFE;AAGFc,MAAAA,MAHE;AAIFC,MAAAA,OAJE;AAKFC,MAAAA,iBALE;AAMFC,MAAAA,KANE;AAOFC,MAAAA,KAPE;AAQFC,MAAAA,aARE;AASFC,MAAAA,YAAY,EAAE;AAAEC,QAAAA,GAAG,GAAG,CAAR;AAAWC,QAAAA,MAAM,GAAG,CAApB;AAAuBC,QAAAA,IAAI,GAAG,CAA9B;AAAiCC,QAAAA,KAAK,GAAG;AAAzC,OATZ;AAUFC,MAAAA,OAVE;AAWFC,MAAAA,OAXE;AAYFC,MAAAA,QAZE;AAaFxB,MAAAA,MAbE;AAcFF,MAAAA,KAdE;AAeF2B,MAAAA,IAfE;AAgBFC,MAAAA,SAhBE;AAiBFC,MAAAA,MAjBE;AAkBFC,MAAAA,MAlBE;AAmBFC,MAAAA;AAnBE,QAoBF,KAAKC,KApBT;AAsBA,UAAM;AAAErC,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAoB,KAAKqC,KAA/B;;AAEA,QAAInC,IAAI,CAACoC,MAAL,KAAgB,CAApB,EAAuB;AACnB,aAAO,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAElB;AAAb,QAAP;AACH;;AAED,UAAMZ,MAAM,GAAGhB,KAAK,CACfiB,KADU,GAEVN,IAFU,CAELA,IAFK,EAGVC,KAHU,CAGJA,KAHI,EAIVE,MAJU,CAIHA,MAJG,EAIKJ,IAJL,CAAf,CA7BK,CAmCL;;AACA,UAAMqC,OAAO,GAAGjD,KAAK,CAACoB,KAAN,CAAYpB,KAAK,CAACoB,KAAN,CAAYF,MAAZ,CAAZ,CAAhB;AACA,UAAMgC,OAAO,GAAGtC,IAAI,CAACuC,GAAL,CAAS,CAACC,IAAD,EAAOC,KAAP,KAAiBX,SAAS,CAAC;AAAEU,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAAD,CAAnC,CAAhB;AAEA,UAAMC,OAAO,GAAGtD,KAAK,CAACuD,MAAN,CAAa,CAAC,GAAGN,OAAJ,EAAaX,OAAb,EAAsBC,OAAtB,CAAb,CAAhB;AACA,UAAMiB,OAAO,GAAGxD,KAAK,CAACuD,MAAN,CAAaL,OAAb,CAAhB;AAEA,UAAM;AAAEO,MAAAA,IAAI,GAAGH,OAAO,CAAC,CAAD,CAAhB;AAAqBI,MAAAA,IAAI,GAAGJ,OAAO,CAAC,CAAD,CAAnC;AAAwCK,MAAAA,IAAI,GAAGH,OAAO,CAAC,CAAD,CAAtD;AAA2DI,MAAAA,IAAI,GAAGJ,OAAO,CAAC,CAAD;AAAzE,QAAiF,KAAKV,KAA5F,CA1CK,CA4CL;;AACA,UAAMe,CAAC,GAAG5D,KAAK,CACV6D,WADK,GAELC,MAFK,CAEE,CAACN,IAAD,EAAOC,IAAP,CAFF,EAGLM,KAHK,CAGC,CAACvD,MAAM,GAAG0B,MAAV,EAAkBD,GAAlB,CAHD,EAIL+B,KAJK,CAICrB,MAJD,CAAV;AAMA,UAAMsB,CAAC,GAAGvB,MAAM,GACXoB,MADK,CACE,CAACJ,IAAD,EAAOC,IAAP,CADF,EAELI,KAFK,CAEC,CAAC5B,IAAD,EAAO1B,KAAK,GAAG2B,KAAf,CAFD,EAGL4B,KAHK,CAGCpB,MAHD,CAAV;AAKA,UAAMsB,KAAK,GAAGN,CAAC,CAACM,KAAF,CAAQnC,aAAR,CAAd;AAEA,UAAMoC,KAAK,GAAGlD,MAAM,CAACiC,GAAP,CAAW,CAACkB,KAAD,EAAQhB,KAAR,KAAkB;AACvC,YAAMiB,IAAI,GAAGpE,KAAK,CACbqE,IADQ,GAERL,CAFQ,CAEN,CAACM,CAAD,EAAInB,KAAJ,KAAca,CAAC,CAACxB,SAAS,CAAC;AAAEU,QAAAA,IAAI,EAAEoB,CAAC,CAAC5D,IAAV;AAAgByC,QAAAA;AAAhB,OAAD,CAAV,CAFT,EAGRoB,EAHQ,CAGJD,CAAD,IAAOX,CAAC,CAACW,CAAC,CAAC,CAAD,CAAF,CAHH,EAIRE,EAJQ,CAIJF,CAAD,IAAOX,CAAC,CAACW,CAAC,CAAC,CAAD,CAAF,CAJH,EAKRzC,KALQ,CAKFA,KALE,EAKKnB,IAAI,CAACuC,GAAL,CAAS,CAACwB,CAAD,EAAItB,KAAJ,KAAcgB,KAAK,CAAChB,KAAD,CAA5B,CALL,CAAb;AAOA,aAAO;AACHiB,QAAAA,IADG;AAEHM,QAAAA,GAAG,EAAE/D,IAAI,CAACwC,KAAD,CAFN;AAGHwB,QAAAA,KAAK,EAAElD,MAAM,CAAC0B,KAAD;AAHV,OAAP;AAKH,KAba,CAAd;AAeA,UAAMyB,UAAU,GAAG;AACfZ,MAAAA,CADe;AAEfL,MAAAA,CAFe;AAGfnD,MAAAA,KAHe;AAIfD,MAAAA,MAJe;AAKf0D,MAAAA,KALe;AAMfC,MAAAA;AANe,KAAnB;AASA,WACI,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAEtC;AAAb,OACI,oBAAC,IAAD;AAAM,MAAA,KAAK,EAAE;AAAEiD,QAAAA,IAAI,EAAE;AAAR,OAAb;AAA0B,MAAA,QAAQ,EAAGzD,KAAD,IAAW,KAAKD,SAAL,CAAeC,KAAf;AAA/C,OACKb,MAAM,GAAG,CAAT,IAAcC,KAAK,GAAG,CAAtB,IACG,oBAAC,GAAD;AAAK,MAAA,KAAK,EAAE;AAAED,QAAAA,MAAF;AAAUC,QAAAA;AAAV;AAAZ,OACKP,KAAK,CAAC6E,QAAN,CAAe7B,GAAf,CAAmBX,QAAnB,EAA8ByC,KAAD,IAAW;AACrC,UAAIA,KAAK,IAAIA,KAAK,CAACnC,KAAN,CAAYoC,UAAzB,EAAqC;AACjC,eAAO/E,KAAK,CAACgF,YAAN,CAAmBF,KAAnB,EAA0BH,UAA1B,CAAP;AACH;;AACD,aAAO,IAAP;AACH,KALA,CADL,EAOKV,KAAK,CAACjB,GAAN,CAAU,CAACoB,IAAD,EAAOlB,KAAP,KACP,oBAAC,IAAD;AACI,MAAA,GAAG,EAAEkB,IAAI,CAACK,GADd;AAEI,MAAA,IAAI,EAAEL,IAAI,CAACM;AAFf,OAGQpC,IAAI,CAACY,KAAD,CAHZ;AAII,MAAA,OAAO,EAAEzB,OAJb;AAKI,MAAA,iBAAiB,EAAEC,iBALvB;AAMI,MAAA,CAAC,EAAE0C,IAAI,CAACD;AANZ,OADH,CAPL,EAiBKnE,KAAK,CAAC6E,QAAN,CAAe7B,GAAf,CAAmBX,QAAnB,EAA8ByC,KAAD,IAAW;AACrC,UAAIA,KAAK,IAAI,CAACA,KAAK,CAACnC,KAAN,CAAYoC,UAA1B,EAAsC;AAClC,eAAO/E,KAAK,CAACgF,YAAN,CAAmBF,KAAnB,EAA0BH,UAA1B,CAAP;AACH;;AACD,aAAO,IAAP;AACH,KALA,CAjBL,CAFR,CADJ,CADJ;AAgCH;;AA5IiC;;AA+ItCtE,SAAS,CAAC4E,SAAV,GAAsB;AAClBxE,EAAAA,IAAI,EAAEb,SAAS,CAACsF,OAAV,CAAkBtF,SAAS,CAACuF,MAA5B,EAAoCC,UADxB;AAElB1E,EAAAA,IAAI,EAAEd,SAAS,CAACsF,OAAV,CAAkBtF,SAAS,CAACyF,MAA5B,EAAoCD,UAFxB;AAGlB5D,EAAAA,MAAM,EAAE5B,SAAS,CAACsF,OAAV,CAAkBtF,SAAS,CAACyF,MAA5B,EAAoCD,UAH1B;AAIlB9C,EAAAA,IAAI,EAAE1C,SAAS,CAACsF,OAAV,CAAkBtF,SAAS,CAACuF,MAA5B,CAJY;AAKlBtE,EAAAA,MAAM,EAAEjB,SAAS,CAAC0F,IALA;AAMlB3E,EAAAA,KAAK,EAAEf,SAAS,CAAC0F,IANC;AAOlB3D,EAAAA,KAAK,EAAE/B,SAAS,CAAC2F,GAPC;AAQlB9D,EAAAA,OAAO,EAAE7B,SAAS,CAAC4F,IARD;AASlB9D,EAAAA,iBAAiB,EAAE9B,SAAS,CAAC6F,MATX;AAUlB3D,EAAAA,YAAY,EAAElC,SAAS,CAACG,KAAV,CAAgB;AAC1BgC,IAAAA,GAAG,EAAEnC,SAAS,CAAC6F,MADW;AAE1BxD,IAAAA,IAAI,EAAErC,SAAS,CAAC6F,MAFU;AAG1BvD,IAAAA,KAAK,EAAEtC,SAAS,CAAC6F,MAHS;AAI1BzD,IAAAA,MAAM,EAAEpC,SAAS,CAAC6F;AAJQ,GAAhB,CAVI;AAgBlB5D,EAAAA,aAAa,EAAEjC,SAAS,CAAC6F,MAhBP;AAiBlBC,EAAAA,QAAQ,EAAE9F,SAAS,CAAC4F,IAjBF;AAkBlBhD,EAAAA,MAAM,EAAE5C,SAAS,CAAC0F,IAlBA;AAmBlB/C,EAAAA,SAAS,EAAE3C,SAAS,CAAC0F,IAnBH;AAqBlBhC,EAAAA,IAAI,EAAE1D,SAAS,CAAC2F,GArBE;AAsBlBhC,EAAAA,IAAI,EAAE3D,SAAS,CAAC2F,GAtBE;AAuBlB/B,EAAAA,IAAI,EAAE5D,SAAS,CAAC2F,GAvBE;AAwBlB9B,EAAAA,IAAI,EAAE7D,SAAS,CAAC2F,GAxBE;AAyBlB7C,EAAAA,MAAM,EAAE9C,SAAS,CAAC4F,IAzBA;AA0BlB/C,EAAAA,MAAM,EAAE7C,SAAS,CAAC4F;AA1BA,CAAtB;AA6BAnF,SAAS,CAACsF,YAAV,GAAyB;AACrB/D,EAAAA,KAAK,EAAE7B,KAAK,CAAC6F,WADQ;AAErB/E,EAAAA,MAAM,EAAEd,KAAK,CAACe,eAFO;AAGrBH,EAAAA,KAAK,EAAEZ,KAAK,CAACa,cAHQ;AAIrB0B,EAAAA,IAAI,EAAE,EAJe;AAKrBuD,EAAAA,WAAW,EAAE,CALQ;AAMrB/D,EAAAA,YAAY,EAAE,EANO;AAOrBD,EAAAA,aAAa,EAAE,EAPM;AAQrB6D,EAAAA,QAAQ,EAAE,IARW;AASrBlD,EAAAA,MAAM,EAAE1C,KAAK,CAAC6D,WATO;AAUrBpB,EAAAA,SAAS,EAAE,CAAC;AAAEW,IAAAA;AAAF,GAAD,KAAeA;AAVL,CAAzB;AAaA,eAAe7C,SAAf","sourcesContent":["import PropTypes from 'prop-types'\r\nimport * as array from 'd3-array'\r\nimport * as scale from 'd3-scale'\r\nimport * as shape from 'd3-shape'\r\nimport React, { PureComponent } from 'react'\r\nimport { View } from 'react-native'\r\nimport { Svg } from 'react-native-svg'\r\nimport Path from './animated-path'\r\n\r\nclass AreaStack extends PureComponent {\r\n    static extractDataPoints(data, keys, order = shape.stackOrderNone, offset = shape.stackOffsetNone) {\r\n        const series = shape\r\n            .stack()\r\n            .keys(keys)\r\n            .order(order)\r\n            .offset(offset)(data)\r\n\r\n        //double merge arrays to extract just the values\r\n        return array.merge(array.merge(series))\r\n    }\r\n\r\n    state = {\r\n        height: 0,\r\n        width: 0,\r\n    }\r\n\r\n    _onLayout(event) {\r\n        const {\r\n            nativeEvent: {\r\n                layout: { height, width },\r\n            },\r\n        } = event\r\n        this.setState({ height, width })\r\n    }\r\n\r\n    render() {\r\n        const {\r\n            data,\r\n            keys,\r\n            colors,\r\n            animate,\r\n            animationDuration,\r\n            style,\r\n            curve,\r\n            numberOfTicks,\r\n            contentInset: { top = 0, bottom = 0, left = 0, right = 0 },\r\n            gridMin,\r\n            gridMax,\r\n            children,\r\n            offset,\r\n            order,\r\n            svgs,\r\n            xAccessor,\r\n            xScale,\r\n            clampY,\r\n            clampX,\r\n        } = this.props\r\n\r\n        const { height, width } = this.state\r\n\r\n        if (data.length === 0) {\r\n            return <View style={style} />\r\n        }\r\n\r\n        const series = shape\r\n            .stack()\r\n            .keys(keys)\r\n            .order(order)\r\n            .offset(offset)(data)\r\n\r\n        //double merge arrays to extract just the yValues\r\n        const yValues = array.merge(array.merge(series))\r\n        const xValues = data.map((item, index) => xAccessor({ item, index }))\r\n\r\n        const yExtent = array.extent([...yValues, gridMin, gridMax])\r\n        const xExtent = array.extent(xValues)\r\n\r\n        const { yMin = yExtent[0], yMax = yExtent[1], xMin = xExtent[0], xMax = xExtent[1] } = this.props\r\n\r\n        //invert range to support svg coordinate system\r\n        const y = scale\r\n            .scaleLinear()\r\n            .domain([yMin, yMax])\r\n            .range([height - bottom, top])\r\n            .clamp(clampY)\r\n\r\n        const x = xScale()\r\n            .domain([xMin, xMax])\r\n            .range([left, width - right])\r\n            .clamp(clampX)\r\n\r\n        const ticks = y.ticks(numberOfTicks)\r\n\r\n        const areas = series.map((serie, index) => {\r\n            const path = shape\r\n                .area()\r\n                .x((d, index) => x(xAccessor({ item: d.data, index })))\r\n                .y0((d) => y(d[0]))\r\n                .y1((d) => y(d[1]))\r\n                .curve(curve)(data.map((_, index) => serie[index]))\r\n\r\n            return {\r\n                path,\r\n                key: keys[index],\r\n                color: colors[index],\r\n            }\r\n        })\r\n\r\n        const extraProps = {\r\n            x,\r\n            y,\r\n            width,\r\n            height,\r\n            ticks,\r\n            areas,\r\n        }\r\n\r\n        return (\r\n            <View style={style}>\r\n                <View style={{ flex: 1 }} onLayout={(event) => this._onLayout(event)}>\r\n                    {height > 0 && width > 0 && (\r\n                        <Svg style={{ height, width }}>\r\n                            {React.Children.map(children, (child) => {\r\n                                if (child && child.props.belowChart) {\r\n                                    return React.cloneElement(child, extraProps)\r\n                                }\r\n                                return null\r\n                            })}\r\n                            {areas.map((area, index) => (\r\n                                <Path\r\n                                    key={area.key}\r\n                                    fill={area.color}\r\n                                    {...svgs[index]}\r\n                                    animate={animate}\r\n                                    animationDuration={animationDuration}\r\n                                    d={area.path}\r\n                                />\r\n                            ))}\r\n                            {React.Children.map(children, (child) => {\r\n                                if (child && !child.props.belowChart) {\r\n                                    return React.cloneElement(child, extraProps)\r\n                                }\r\n                                return null\r\n                            })}\r\n                        </Svg>\r\n                    )}\r\n                </View>\r\n            </View>\r\n        )\r\n    }\r\n}\r\n\r\nAreaStack.propTypes = {\r\n    data: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n    keys: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n    colors: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n    svgs: PropTypes.arrayOf(PropTypes.object),\r\n    offset: PropTypes.func,\r\n    order: PropTypes.func,\r\n    style: PropTypes.any,\r\n    animate: PropTypes.bool,\r\n    animationDuration: PropTypes.number,\r\n    contentInset: PropTypes.shape({\r\n        top: PropTypes.number,\r\n        left: PropTypes.number,\r\n        right: PropTypes.number,\r\n        bottom: PropTypes.number,\r\n    }),\r\n    numberOfTicks: PropTypes.number,\r\n    showGrid: PropTypes.bool,\r\n    xScale: PropTypes.func,\r\n    xAccessor: PropTypes.func,\r\n\r\n    yMin: PropTypes.any,\r\n    yMax: PropTypes.any,\r\n    xMin: PropTypes.any,\r\n    xMax: PropTypes.any,\r\n    clampX: PropTypes.bool,\r\n    clampY: PropTypes.bool,\r\n}\r\n\r\nAreaStack.defaultProps = {\r\n    curve: shape.curveLinear,\r\n    offset: shape.stackOffsetNone,\r\n    order: shape.stackOrderNone,\r\n    svgs: [],\r\n    strokeWidth: 2,\r\n    contentInset: {},\r\n    numberOfTicks: 10,\r\n    showGrid: true,\r\n    xScale: scale.scaleLinear,\r\n    xAccessor: ({ index }) => index,\r\n}\r\n\r\nexport default AreaStack\r\n"]}